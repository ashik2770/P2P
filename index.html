<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🔥 Fast P2P File Sharing + Video Call</title>
    <script src="https://unpkg.com/peerjs@1.3.1/dist/peerjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
const peer = new Peer();
let conn, call;

// Show Peer ID & Generate QR Code
peer.on('open', id => {
    document.getElementById('peer-id').textContent = id;
    new QRCode(document.getElementById('qrcode'), id);
});

// Copy ID to Clipboard
document.getElementById('copy-id').addEventListener('click', () => {
    const id = document.getElementById('peer-id').textContent;
    navigator.clipboard.writeText(id);
    alert("Copied to clipboard: " + id);
});

// Connect to Peer
function connectPeer() {
    const receiverId = document.getElementById('connect-id').value;
    conn = peer.connect(receiverId);

    conn.on('open', () => {
        document.getElementById('status').textContent = "✅ Connected to " + receiverId;
    });

    conn.on('data', receiveFile);
}

// Send File
function sendFile() {
    const fileInput = document.getElementById('fileInput');
    if (fileInput.files.length > 0 && conn) {
        const file = fileInput.files[0];
        conn.send({ filename: file.name, data: file });
        alert(`File Sent: ${file.name}`);
    }
}

// Receive File
function receiveFile(data) {
    let blob = new Blob([data.data]);
    let url = URL.createObjectURL(blob);

    let downloadLink = document.getElementById('download-link');
    downloadLink.href = url;
    downloadLink.download = data.filename;
    downloadLink.textContent = "📥 Download " + data.filename;
    downloadLink.classList.remove("hidden");
}

// Start Voice Call
function startVoiceCall() {
    navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
        call = peer.call(document.getElementById('connect-id').value, stream);
        document.getElementById('end-call').classList.remove('hidden');
    });
}

// Start Video Call
function startVideoCall() {
    navigator.mediaDevices.getUserMedia({ video: true, audio: true }).then(stream => {
        document.getElementById('localVideo').srcObject = stream;
        document.getElementById('localVideo').classList.remove('hidden');
        call = peer.call(document.getElementById('connect-id').value, stream);
        document.getElementById('end-call').classList.remove('hidden');
    });
}

// End Call
function endCall() {
    if (call) call.close();
    document.getElementById('end-call').classList.add('hidden');
}
</script>
    <style>
        body { font-family: 'Arial', sans-serif; }
        .hidden { display: none; }
        .btn { transition: all 0.3s ease-in-out; }
        #drop-zone { transition: all 0.3s ease-in-out; }
        #drop-zone:hover { background: rgba(255, 255, 255, 0.1); }
    </style>
</head>
<body class="bg-gray-900 text-white flex flex-col items-center justify-center min-h-screen p-4">
    
    <h1 class="text-3xl font-extrabold mb-4 text-blue-500 text-center">
        ⚡ Fast & Secure P2P File Sharing + Video Call
    </h1>

    <div class="bg-gray-800 p-4 rounded-lg shadow-lg text-center w-full sm:w-auto">
        <p>Your ID: <span id="peer-id" class="font-bold text-green-400"></span></p>
        <button id="copy-id" class="mt-2 px-3 py-1 bg-blue-600 hover:bg-blue-700 rounded text-sm btn">
            📋 Copy ID
        </button>
        <div id="qrcode" class="mt-3"></div>
    </div>

    <input type="text" id="connect-id" placeholder="Enter Receiver's ID"
        class="mt-2 p-2 bg-gray-800 border border-gray-700 rounded w-full sm:w-64 text-center">

    <button onclick="connectPeer()" class="mt-3 px-4 py-2 bg-green-600 hover:bg-green-700 rounded btn">
        🔗 Connect
    </button>

    <p id="status" class="mt-2 text-sm text-yellow-400"></p>

    <!-- File Drop Zone -->
    <div id="drop-zone" class="mt-4 border-dashed border-2 border-gray-500 w-full sm:w-64 h-32 flex items-center justify-center text-center cursor-pointer">
        Drag & Drop or Click to Select File
    </div>

    <input type="file" id="fileInput" multiple class="hidden">
    <button onclick="sendFile()" class="mt-3 px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded btn">
        🚀 Send File
    </button>

    <!-- Progress Bar -->
    <div id="progress-bar-container" class="mt-3 w-full sm:w-64 bg-gray-700 rounded-full overflow-hidden hidden">
        <div id="progress-bar" class="h-2 bg-blue-500 w-0"></div>
    </div>

    <a id="download-link" class="mt-3 hidden text-blue-400 underline">📥 Download Received File</a>

    <!-- Call Buttons -->
    <button onclick="startVoiceCall()" class="mt-3 px-4 py-2 bg-green-500 hover:bg-green-600 rounded btn">🔊 Start Voice Call</button>
    <button onclick="startVideoCall()" class="mt-3 px-4 py-2 bg-red-500 hover:bg-red-600 rounded btn">📹 Start Video Call</button>
    <button onclick="endCall()" class="mt-3 px-4 py-2 bg-gray-500 hover:bg-gray-600 rounded btn hidden" id="end-call">❌ End Call</button>

    <!-- Video Call Screen -->
    <video id="localVideo" autoplay class="mt-4 hidden border-2 border-green-400 rounded-lg w-full sm:w-1/2"></video>
    <video id="remoteVideo" autoplay class="mt-2 hidden border-2 border-blue-400 rounded-lg w-full sm:w-1/2"></video>

</body>
</html>
