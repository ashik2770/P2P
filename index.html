<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Futuristic Video Call</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .futuristic-bg {
            background: linear-gradient(135deg, #1a1b41 0%, #2a2b5f 100%);
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .glow-effect {
            box-shadow: 0 0 20px rgba(147, 51, 234, 0.3);
        }
    </style>
</head>
<body class="futuristic-bg min-h-screen flex items-center justify-center p-4">
    <div class="container mx-auto max-w-4xl">
        <div class="glass-effect rounded-2xl p-6 glow-effect">
            <h1 class="text-3xl font-bold text-white mb-6 text-center bg-gradient-to-r from-purple-400 to-pink-600 bg-clip-text text-transparent">
                Quantum Call
            </h1>

            <!-- Connection Controls -->
            <div class="flex flex-col gap-4 mb-6">
                <div class="flex flex-col md:flex-row gap-4">
                    <input 
                        id="userId" 
                        type="text" 
                        placeholder="Your Unique ID" 
                        class="flex-1 p-3 rounded-lg bg-gray-800/50 text-white border border-gray-700 focus:outline-none focus:border-purple-500 transition-all"
                    >
                    <button 
                        id="startBtn" 
                        class="px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-all duration-300 transform hover:scale-105"
                    >
                        Start Call
                    </button>
                </div>

                <!-- Signaling Text Areas -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="text-white mb-2 block">Your Offer/Answer (Copy this):</label>
                        <textarea 
                            id="localDescription" 
                            readonly 
                            class="w-full p-3 rounded-lg bg-gray-800/50 text-white border border-gray-700 h-32 resize-none"
                        ></textarea>
                    </div>
                    <div>
                        <label class="text-white mb-2 block">Paste Remote Offer/Answer Here:</label>
                        <textarea 
                            id="remoteDescription" 
                            class="w-full p-3 rounded-lg bg-gray-800/50 text-white border border-gray-700 h-32 resize-none"
                        ></textarea>
                        <button 
                            id="setRemoteBtn" 
                            class="mt-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-all duration-300"
                        >
                            Set Remote
                        </button>
                    </div>
                </div>
            </div>

            <!-- Video Containers -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div class="relative">
                    <video 
                        id="localVideo" 
                        autoplay 
                        muted 
                        class="w-full rounded-lg border border-gray-700 glow-effect"
                    ></video>
                    <span class="absolute bottom-2 left-2 text-white bg-black/50 px-2 py-1 rounded">You</span>
                </div>
                <div class="relative">
                    <video 
                        id="remoteVideo" 
                        autoplay 
                        class="w-full rounded-lg border border-gray-700 glow-effect"
                    ></video>
                    <span class="absolute bottom-2 left-2 text-white bg-black/50 px-2 py-1 rounded">Remote</span>
                </div>
            </div>

            <!-- Controls -->
            <div class="flex justify-center gap-4">
                <button 
                    id="toggleVideo" 
                    class="p-3 bg-gray-800 hover:bg-gray-700 text-white rounded-full transition-all duration-300"
                >
                    ðŸ“¹
                </button>
                <button 
                    id="toggleAudio" 
                    class="p-3 bg-gray-800 hover:bg-gray-700 text-white rounded-full transition-all duration-300"
                >
                    ðŸŽ¤
                </button>
                <button 
                    id="endCall" 
                    class="p-3 bg-red-600 hover:bg-red-700 text-white rounded-full transition-all duration-300"
                >
                    âœ•
                </button>
            </div>

            <!-- Status -->
            <p id="status" class="text-center text-gray-400 mt-4"></p>
        </div>
    </div>

    <script>
        // WebRTC Configuration
        const configuration = {
            iceServers: [
                { urls: 'stun:stun.l.google.com:19302' },
                { urls: 'stun:stun1.l.google.com:19302' }
            ]
        };

        // DOM Elements
        const localVideo = document.getElementById('localVideo');
        const remoteVideo = document.getElementById('remoteVideo');
        const userId = document.getElementById('userId');
        const startBtn = document.getElementById('startBtn');
        const localDescription = document.getElementById('localDescription');
        const remoteDescription = document.getElementById('remoteDescription');
        const setRemoteBtn = document.getElementById('setRemoteBtn');
        const toggleVideoBtn = document.getElementById('toggleVideo');
        const toggleAudioBtn = document.getElementById('toggleAudio');
        const endCallBtn = document.getElementById('endCall');
        const status = document.getElementById('status');

        // WebRTC Variables
        let localStream;
        let peerConnection;

        // Generate random ID if empty
        userId.value = userId.value || Math.random().toString(36).substring(2, 10);

        // Get media stream
        async function startMedia() {
            try {
                localStream = await navigator.mediaDevices.getUserMedia({ 
                    video: true, 
                    audio: true 
                });
                localVideo.srcObject = localStream;
                status.textContent = 'Connected to local stream';
            } catch (error) {
                console.error('Media error:', error);
                status.textContent = 'Error accessing media devices';
            }
        }

        // Create peer connection
        function createPeerConnection() {
            peerConnection = new RTCPeerConnection(configuration);

            // Add local stream tracks
            localStream.getTracks().forEach(track => {
                peerConnection.addTrack(track, localStream);
            });

            // Handle remote stream
            peerConnection.ontrack = (event) => {
                remoteVideo.srcObject = event.streams[0];
                status.textContent = 'Connected to remote stream';
            };

            // Collect ICE candidates and display them with the offer/answer
            peerConnection.onicecandidate = (event) => {
                if (event.candidate) {
                    localDescription.value = JSON.stringify({
                        sdp: peerConnection.localDescription,
                        candidates: (JSON.parse(localDescription.value || '{}').candidates || []).concat([event.candidate])
                    });
                }
            };

            peerConnection.onconnectionstatechange = () => {
                status.textContent = `Connection state: ${peerConnection.connectionState}`;
            };
        }

        // Start call (create offer)
        startBtn.onclick = async () => {
            await startMedia();
            createPeerConnection();

            const offer = await peerConnection.createOffer();
            await peerConnection.setLocalDescription(offer);
            localDescription.value = JSON.stringify({
                sdp: offer,
                candidates: []
            });
            status.textContent = 'Copy the text above and send it to the remote user';
        };

        // Handle remote description
        setRemoteBtn.onclick = async () => {
            try {
                const remoteData = JSON.parse(remoteDescription.value);
                const remoteSdp = new RTCSessionDescription(remoteData.sdp);

                if (remoteSdp.type === 'offer') {
                    // If this is an offer, create an answer
                    await startMedia();
                    createPeerConnection();
                    await peerConnection.setRemoteDescription(remoteSdp);
                    const answer = await peerConnection.createAnswer();
                    await peerConnection.setLocalDescription(answer);
                    localDescription.value = JSON.stringify({
                        sdp: answer,
                        candidates: []
                    });
                    status.textContent = 'Answer created, send it back to the caller';

                    // Add ICE candidates from the offer
                    remoteData.candidates.forEach(candidate => {
                        peerConnection.addIceCandidate(new RTCIceCandidate(candidate));
                    });
                } else if (remoteSdp.type === 'answer') {
                    // If this is an answer, set it
                    await peerConnection.setRemoteDescription(remoteSdp);
                    remoteData.candidates.forEach(candidate => {
                        peerConnection.addIceCandidate(new RTCIceCandidate(candidate));
                    });
                    status.textContent = 'Call connected';
                }
            } catch (error) {
                console.error('Error setting remote description:', error);
                status.textContent = 'Error processing remote data';
            }
        };

        // Control buttons
        let videoEnabled = true;
        let audioEnabled = true;

        toggleVideoBtn.onclick = () => {
            videoEnabled = !videoEnabled;
            localStream.getVideoTracks()[0].enabled = videoEnabled;
            toggleVideoBtn.classList.toggle('bg-purple-600', videoEnabled);
        };

        toggleAudioBtn.onclick = () => {
            audioEnabled = !audioEnabled;
            localStream.getAudioTracks()[0].enabled = audioEnabled;
            toggleAudioBtn.classList.toggle('bg-purple-600', audioEnabled);
        };

        endCallBtn.onclick = () => {
            if (peerConnection) {
                peerConnection.close();
                localStream.getTracks().forEach(track => track.stop());
                localVideo.srcObject = null;
                remoteVideo.srcObject = null;
                localDescription.value = '';
                remoteDescription.value = '';
                status.textContent = 'Call ended';
            }
        };

        // Handle window resize
        window.addEventListener('resize', () => {
            localVideo.style.height = `${localVideo.offsetWidth * 9 / 16}px`;
            remoteVideo.style.height = `${remoteVideo.offsetWidth * 9 / 16}px`;
        });
    </script>
</body>
</html>
